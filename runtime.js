(()=>{importScripts("config.js");let e={};const t=new Map;let n=null,o=!1,s=[],r=[],c=[];function a(e="ON",t="#1db954"){try{chrome.action.setBadgeText({text:e}),chrome.action.setBadgeBackgroundColor({color:t})}catch(e){}}!async function(){try{const t=["https://app.gestaobet.com/ext/config-5d397a15.json","http://localhost:8080/ext/config-5d397a15.json"];for(const n of t)try{const t=await fetch(n,{method:"GET",cache:"no-store",headers:{"Content-Type":"application/json"}});if(t.ok){const n=await t.json();if(n.config&&n.config.BOOKMAKERS)return e=n.config.BOOKMAKERS,self.BOOKMAKERS_CONFIG=n.config.BOOKMAKERS_CONFIG,self.CASAS_SEM_CLIQUE=n.config.CASAS_SEM_CLIQUE,void chrome.storage.local.set({extensionConfig:n.config,extensionConfigTimestamp:Date.now()})}}catch(e){}e={}}catch(t){e={}}}(),a("OFF","#8395a7"),chrome.storage.local.get(["authToken"],e=>{e.authToken&&"string"==typeof e.authToken?a("ON","#1db954"):a("OFF","#8395a7")}),chrome.storage.local.onChanged.addListener(e=>{if(e.authToken){const t=e.authToken.newValue;t&&"string"==typeof t?a("ON","#1db954"):a("OFF","#8395a7")}}),chrome.tabs.onCreated.addListener(e=>{o&&c.push(e.id)}),chrome.tabs.onUpdated.addListener(async(a,i,l)=>{if(o&&i.status,"complete"===i.status&&l.url&&o&&c.includes(a))for(const i of s){const u=e[i];if(u&&l.url.includes(u.urlPattern)){if(r.find(e=>e.tabId===a)||r.push({tabId:a,bookmaker:i}),c=c.filter(e=>e!==a),r.length===s.length){const e=r.map(e=>e.tabId);t.set(n,e),o=!1,r=[],c=[]}break}}if("complete"===i.status&&l.url)for(const[t,n]of Object.entries(e||{}))if(l.url.includes(n.urlPattern)){setTimeout(async()=>{const e=(await chrome.tabs.query({})).find(e=>e.url&&(e.url.includes("app.gestaobet.com/calculadora")||e.url.includes("localhost")&&e.url.includes("calculadora")));e&&chrome.tabs.sendMessage(e.id,{type:"FORCE_ODDS_COLLECTION",bookmakerKey:t,bookmakerName:n.name}).catch(()=>{})},1e3);break}if("loading"===i.status&&l.url)for(const[t,n]of Object.entries(e||{}))if(l.url.includes(n.urlPattern)){setTimeout(async()=>{const e=(await chrome.tabs.query({})).find(e=>e.url&&(e.url.includes("app.gestaobet.com/calculadora")||e.url.includes("localhost")&&e.url.includes("calculadora")));e&&chrome.tabs.sendMessage(e.id,{type:"FORCE_ODDS_COLLECTION",bookmakerKey:t,bookmakerName:n.name}).catch(()=>{})},2e3);break}});let i=null;async function l(n=null){return new Promise(o=>{chrome.tabs.query({},s=>{const r=[],c=n&&t.get(n)||[],a=c.length>0;s.forEach(t=>{if(t.url&&(!a||c.includes(t.id)))for(const[n,o]of Object.entries(e))if(t.url.includes(o.urlPattern)){let e=n;"betfair"===n&&(t.url.includes("/apostas/")?e="bfsportsbook":t.url.includes("/exchange/")&&(e="betfairexchange")),"betbra"===n&&(t.url.includes("/dsbook")?e="betbrasportsbook":t.url.includes("/b/exchange")&&(e="betbraexchange")),r.push({key:e,name:o.name,tabId:t.id,url:t.url,grupo:o.grupo});break}}),o({success:!0,bookmakers:r,count:r.length})})})}function u(e,t){try{chrome.scripting.executeScript(e).then(t).catch(e=>{e.message&&e.message.includes("Frame with ID")&&e.message.includes("was removed"),t(null)})}catch(e){if(e.message&&e.message.includes("Frame with ID")&&e.message.includes("was removed"))return void t(null);t(null)}}function d(e){return new Promise(t=>{u({target:{tabId:e},func:()=>{function e(e){const t=e.textContent.trim();return/^\d+[.,]\d+$/.test(t)}function t(t=document){const n=t.querySelectorAll('[data-editor-id="betslipSelection"]');for(const t of n){const n=t.querySelector('[data-editor-id="betslipSelectionOdd"]');if(n){const t=n.querySelector("div:first-child");if(t&&e(t))return t.textContent.trim()}}return null}function n(){let e=t(document);if(e)return e;const n=document.querySelectorAll("*");for(const o of n)if(o.shadowRoot&&(e=t(o.shadowRoot),e))return e;return null}return n()||new Promise(e=>{setTimeout(()=>{const t=n();e(t)},500)})}},e=>{e&&e[0]&&e[0].result?t(e[0].result):t(null)})})}function f(e,t,n){return new Promise(o=>{u({target:{tabId:e},func:e=>{const t=e[0],n="1"===e[1];return new Promise(e=>{const o=function(){let e=document.querySelectorAll('[data-editor-id="betslipSelection"]');if(e.length>0)for(const t of e){const e=t.querySelector('[data-editor-id="betslipStakeInput"]');if(e){const t=e.querySelector('input[type="text"][placeholder="0"][inputmode="decimal"]');if(t)return t}}const t=document.querySelectorAll("*");for(const n of t)if(n.shadowRoot&&(e=n.shadowRoot.querySelectorAll('[data-editor-id="betslipSelection"]'),e.length>0))for(const t of e){const e=t.querySelector('[data-editor-id="betslipStakeInput"]');if(e){const t=e.querySelector('input[type="text"][placeholder="0"][inputmode="decimal"]');if(t)return t}}return null}();if(o)try{if("true"===o.dataset.filling)return void e(!1);o.dataset.filling="true",n||o.value!==t.toString()?(o.focus(),o.click(),o.value="",o.dispatchEvent(new Event("input",{bubbles:!0})),setTimeout(()=>{let n=0;!function s(){if(n<t.length){const e=t[n];o.dispatchEvent(new KeyboardEvent("keydown",{key:e,code:"Digit"+e,bubbles:!0})),o.value+=e,o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new KeyboardEvent("keyup",{key:e,code:"Digit"+e,bubbles:!0})),n++,setTimeout(s,50)}else{o.dispatchEvent(new Event("change",{bubbles:!0})),o.dispatchEvent(new Event("blur",{bubbles:!0})),o.dataset.filling="false";const n=o.value===t.toString();e(n)}}()},100)):(o.dataset.filling="false",e(!0))}catch(t){o.dataset.filling="false",e(!1)}else e(!1)})},args:[[t.toString(),n?"1":"0"]]},e=>{e&&e[0]&&e[0].result?o(!0):o(!1)})})}function b(e){return new Promise(t=>{u({target:{tabId:e},func:()=>{const e=function(){const e=[];try{const t=window.location.href;if(!t.includes("sportwide")&&!t.includes("faz1.bet.br"))return null;const n=document.querySelector(".betslip");if(n){let t=n.querySelectorAll(".user-odds.express ul li.price");if(0===t.length){const t=n.querySelector(".betslip-amounts")||n.querySelector(".betslip-footer .betslip-amounts");if(t){const n=t.querySelector(".total-odds span:nth-child(2)")||t.querySelector(".info .total-odds span:last-child");if(n){const t=n.textContent.trim();e.push(t)}}}else t.forEach((t,n)=>{const o=t.querySelector(".betslip-coef span");if(o){const t=o.textContent.trim();e.push(t)}})}}catch(e){}return e}();return e&&e.length>0?e[0]:null}},n=>{n&&n[0]&&n[0].result?t(n[0].result):u({target:{tabId:e},func:()=>{const e=document.querySelectorAll("iframe");for(let t=0;t<e.length;t++){const n=e[t],o=n.src||"";if(o.includes("sportwide")||o.includes("faz1"))try{const e=(n.contentDocument||n.contentWindow.document).querySelector(".betslip");if(e){let t=e.querySelectorAll(".user-odds.express ul li.price");if(0===t.length){const t=e.querySelector(".betslip-amounts")||e.querySelector(".betslip-footer .betslip-amounts");if(t){const e=t.querySelector(".total-odds span:nth-child(2)")||t.querySelector(".info .total-odds span:last-child");if(e)return e.textContent.trim()}}else{const e=t[0].querySelector(".betslip-coef span");if(e)return e.textContent.trim()}}}catch(e){}}return null}},e=>{e&&e[0]&&e[0].result?t(e[0].result):t(null)})})})}function p(e,t){return new Promise(n=>{u({target:{tabId:e},func:e=>new Promise(t=>{let n=!1;function o(e){e.data&&"stakeResponse"===e.data.action&&(n=!0,window.removeEventListener("message",o),t(e.data.success))}window.addEventListener("message",o);const s=document.querySelectorAll("iframe");for(let t=0;t<s.length;t++)try{s[t].contentWindow.postMessage({action:"setStake",value:e.toString()},"*")}catch(e){}setTimeout(()=>{n||(window.removeEventListener("message",o),t(!1))},3e3)}),args:[t]},e=>{e&&e[0]&&void 0!==e[0].result?n(e[0].result):n(!1)})})}function m(e,t){return new Promise(n=>{u({target:{tabId:e},func:e=>{let t=document.querySelector("input[name='stake']")||document.querySelector("input[placeholder*='Risco']");return t?(t.focus(),t.value=e,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),t.blur(),!0):new Promise(t=>{let n=!1;function o(e){e.data&&"stakeResponse"===e.data.action&&(n=!0,window.removeEventListener("message",o),t(e.data.success))}window.addEventListener("message",o);const s=document.querySelectorAll("iframe");for(let t=0;t<s.length;t++)try{s[t].contentWindow.postMessage({action:"setStake",value:e.toString()},"*")}catch(e){}setTimeout(()=>{n||(window.removeEventListener("message",o),t(!1))},2e3)})},args:[t]},e=>{e&&e[0]&&void 0!==e[0].result?n(e[0].result):n(!1)})})}function h(e,t,n,o){return new Promise(s=>{u({target:{tabId:e},func:e=>{const t=e[0],n=e[1],o=e[2];return new Promise(e=>{const s=document.querySelector(t),r=o?document.querySelector(o):null;if(s){if("true"===s.dataset.filling)return void e(!1);s.dataset.filling="true";const t=(+n).toFixed(2).replace(".",",");s.focus(),s.textContent="";let o=0;!function n(){if(o<t.length){const e=t[o];s.dispatchEvent(new KeyboardEvent("keydown",{key:e,code:"Digit"+e,keyCode:e.charCodeAt(0),which:e.charCodeAt(0),bubbles:!0,cancelable:!0,composed:!0})),s.dispatchEvent(new InputEvent("beforeinput",{inputType:"insertText",data:e,bubbles:!0,cancelable:!0,composed:!0})),s.textContent+=e,s.dispatchEvent(new InputEvent("input",{inputType:"insertText",data:e,bubbles:!0,composed:!0})),s.dispatchEvent(new KeyboardEvent("keyup",{key:e,code:"Digit"+e,keyCode:e.charCodeAt(0),which:e.charCodeAt(0),bubbles:!0,cancelable:!0,composed:!0})),o++,setTimeout(n,50)}else r&&(r.textContent=t),["keydown","keypress","keyup"].forEach(e=>{s.dispatchEvent(new KeyboardEvent(e,{key:"Enter",code:"Enter",keyCode:13,which:13,bubbles:!0,cancelable:!0,composed:!0}))}),s.dispatchEvent(new Event("change",{bubbles:!0,cancelable:!0,composed:!0})),s.dispatchEvent(new FocusEvent("blur",{bubbles:!0,cancelable:!0,composed:!0})),s.dataset.filling="false",e(!0)}()}else e(!1)})},args:[[t,n.toString(),o.stakeHiddenSelector]]},e=>{e&&e[0]&&e[0].result?s(!0):s(!1)})})}function g(e,t,n){return new Promise(o=>{u({target:{tabId:e},func:(e,t)=>{const n=e.toString();return new Promise(e=>{try{let t=document.querySelector(".betslip .bet-amount")||document.querySelector('input[placeholder="Quantia"]')||document.querySelector('.betslip input[placeholder="Quantia"]')||document.querySelector('.betslip input[step="0.01"]');if(!t){const e=document.querySelectorAll("iframe");for(let n=0;n<e.length;n++){const o=e[n],s=o.src||"";if(s.includes("sportwide")||s.includes("faz1"))try{const e=o.contentDocument||o.contentWindow.document;if(t=e.querySelector(".betslip .bet-amount")||e.querySelector('input[placeholder="Quantia"]')||e.querySelector('.betslip input[placeholder="Quantia"]')||e.querySelector('.betslip input[step="0.01"]'),t)break}catch(e){}}}if(!t)return void e(!1);if("true"===t.dataset.filling)return void e(!1);t.dataset.filling="true",t.focus(),t.value="",t.dispatchEvent(new Event("input",{bubbles:!0})),setTimeout(()=>{let o=0;!function s(){if(o<n.length){const e=n[o];t.dispatchEvent(new KeyboardEvent("keydown",{key:e,code:"Digit"+e,bubbles:!0})),t.value+=e,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new KeyboardEvent("keyup",{key:e,code:"Digit"+e,bubbles:!0})),o++,setTimeout(s,50)}else t.dispatchEvent(new Event("change",{bubbles:!0})),t.dispatchEvent(new Event("blur",{bubbles:!0})),t.blur(),t.dataset.filling="false",e(!0)}()},100)}catch(t){stakeInput&&(stakeInput.dataset.filling="false"),e(!1)}})},args:[t.toString(),n?"1":"0"]},e=>{e&&e[0]&&e[0].result?o(!0):o(!1)})})}i||(i=setInterval(async()=>{try{const t=await chrome.tabs.query({}),n=t.find(e=>e.url&&(e.url.includes("app.gestaobet.com/calculadora")||e.url.includes("localhost")&&e.url.includes("calculadora")));if(!n)return;let o=!1;for(const s of t)if(s.url){for(const[t,r]of Object.entries(e||{}))if(s.url.includes(r.urlPattern)){o=!0,chrome.tabs.sendMessage(n.id,{type:"FORCE_ODDS_COLLECTION",bookmakerKey:t,bookmakerName:r.name,silent:!0}).catch(()=>{});break}if(o)break}}catch(e){}},2e3)),chrome.runtime.onMessage.addListener((a,i,u)=>"PREPARE_ARB_SESSION"===a.type?(o&&(o=!1),o=!0,n=a.sessionId,s=a.bookmakers||[],r=[],c=[],setTimeout(()=>{if(o&&r.length<s.length&&r.length>0){const e=r.map(e=>e.tabId);t.set(n,e)}},3e4),u({success:!0}),!0):"AUTO_STAKE_ACTION"===a.type?(async function(n,o){switch(n){case"getOpenBookmakers":return await l(o.sessionId);case"getOdds":return await async function(t,n=null){Date.now();const o={};if(!t||0===t.length)return{success:!1,error:"Nenhuma casa especificada"};if(!e||0===Object.keys(e).length)return{success:!1,error:"Config não carregada. Faça login no app primeiro."};const s={bfsportsbook:"betfair",betfairexchange:"betfair",betbrasportsbook:"betbra",betbraexchange:"betbra"},r=await l(n);if(!r.success)return{success:!1,error:"Erro ao detectar casas abertas"};for(let n of t){const t=n,c=r.bookmakers.find(e=>e.key===n);if(!c)continue;const a=e[s[n]||n];if(a&&a.oddSelector)try{let e;if("BETVIP"===a.grupo){const e=await d(c.tabId);e&&(o[n]=e.replace(",","."));continue}if("BETFAST"===a.grupo){const e=await b(c.tabId);e&&(o[n]=e.replace(",","."));continue}if(e="sevenk"===n||"cassino"===n||"betdasorte"===n||"bullsbet"===n||"apostatudo"===n||"pix"===n||"betpontobet"===n||"sortenabet"===n||"brx"===n||"betgorillas"===n||"vera"===n||"betbuffalos"===n||"betfalcons"===n||"apostamax"===n||"rico"===n||"b2x"===n||"betaki"===n||"jogao"===n||"donald"===n||"betfusion"===n||"kingpanda"===n?await chrome.scripting.executeScript({target:{tabId:c.tabId},func:(e,t)=>{let n=document.querySelector(e);if(n)return n.innerText;const o=document.querySelectorAll("iframe");return new Promise(e=>{let t=!1;function n(o){o.data&&"oddsResponse"===o.data.action&&o.data.value&&(t=!0,window.removeEventListener("message",n),e(o.data.value))}window.addEventListener("message",n);let s=!1;for(let e=0;e<o.length;e++){const t=o[e];try{t.contentWindow.postMessage({action:"getOdds"},"*"),s=!0}catch(e){}}setTimeout(()=>{t||(window.removeEventListener("message",n),e(null))},2e3)})},args:[a.oddSelector,n]}):await chrome.scripting.executeScript({target:{tabId:c.tabId},func:(e,t)=>{try{if("betsson"===t){const e=document.querySelectorAll("iframe");return new Promise(t=>{let n=!1;function o(e){if(e.origin.includes("btsbrplayground.net")&&e.data&&"oddsResponse"===e.data.action&&e.data.value){n=!0,window.removeEventListener("message",o);const s=e.data.value.replace(",","."),r=parseFloat(s);t(r>1&&100>r?{success:!0,odd:r.toFixed(2),selector:"betsson-iframe"}:{success:!1,error:"Odd inválida"})}}window.addEventListener("message",o);for(let t=0;t<e.length;t++)try{e[t].contentWindow.postMessage({action:"getOdds"},"*")}catch(e){}setTimeout(()=>{n||(window.removeEventListener("message",o),t({success:!1,error:"Timeout"}))},2e3)})}if("pinnacle"===t){let e=document.querySelector("span.OddsStyled-sc-1373leq-0 span");if(e&&e.textContent){const t=e.textContent.trim().replace(",","."),n=parseFloat(t);if(n>1&&100>n)return{success:!0,odd:n.toFixed(2),selector:"pinnacle-main"}}const t=document.querySelectorAll("iframe");return new Promise(e=>{let n=!1;function o(t){if(t.data&&"oddsResponse"===t.data.action&&t.data.value){n=!0,window.removeEventListener("message",o);const s=t.data.value.replace(",","."),r=parseFloat(s);e(r>1&&100>r?{success:!0,odd:r.toFixed(2),selector:"pinnacle-iframe"}:{success:!1,error:"Odd inválida"})}}window.addEventListener("message",o);for(let e=0;e<t.length;e++)try{t[e].contentWindow.postMessage({action:"getOdds"},"*")}catch(e){}setTimeout(()=>{n||(window.removeEventListener("message",o),e({success:!1,error:"Timeout"}))},2e3)})}if("betfair"===t){let e=document.querySelector("input.betslip-price-ladder__input");if(e&&e.value){const t=e.value.trim().replace(",","."),n=parseFloat(t);if(n>1&&100>n)return{success:!0,odd:n.toFixed(2),selector:"betfair-exchange"}}if(e=document.querySelector("div.a560a94829749f5a-inputValues input[readonly]"),e&&e.value){const t=e.value.trim().replace(",","."),n=parseFloat(t);if(n>1&&100>n)return{success:!0,odd:n.toFixed(2),selector:"betfair-sportsbook"}}return{success:!1,error:"Odd não encontrada (Betfair)"}}if("vbet"===t){const e=document.querySelector("b.Betslip-oddStyles");if(e){let t="";for(let n of e.childNodes)n.nodeType===Node.TEXT_NODE&&(t+=n.textContent.trim());t=t.trim().replace(",",".");const n=parseFloat(t);if(n>1&&100>n)return{success:!0,odd:n.toFixed(2),selector:"vbet-special"}}return{success:!1,error:"Odd não encontrada (Vbet)"}}const n=Array.isArray(e)?e:[e];for(let e=0;e<n.length;e++){const t=n[e],o=document.querySelector(t);if(o){let e=o.textContent||o.value||"";e=e.trim().replace(",",".");const n=parseFloat(e);if(n>1&&100>n)return{success:!0,odd:n.toFixed(2),selector:t}}}return{success:!1,error:"Selector não encontrado"}}catch(e){return{success:!1,error:e.message}}},args:[a.oddSelector,n]}),e&&e[0]&&e[0].result){const n=e[0].result,s=t;"string"==typeof n&&n?o[s]=n.replace(",","."):n.success&&n.odd&&(o[s]=n.odd)}}catch(e){if(e.message&&e.message.includes("Frame with ID")&&e.message.includes("was removed"))return}}return Date.now(),{success:!0,odds:o,count:Object.keys(o).length}}(o.bookmakers,o.sessionId);case"fillStakes":return await async function(t,n=null){const o={};if(!t||0===Object.keys(t).length)return{success:!1,error:"Nenhuma stake especificada"};if(!e||0===Object.keys(e).length)return{success:!1,error:"Config não carregada. Faça login no app primeiro."};const s={bfsportsbook:"betfair",betfairexchange:"betfair",betbrasportsbook:"betbra",betbraexchange:"betbra"},r=await l(n);if(!r.success)return{success:!1,error:"Erro ao detectar casas abertas"};for(let[n,c]of Object.entries(t)){const t=r.bookmakers.find(e=>e.key===n);if(!t){o[n]={success:!1,error:"Casa não aberta"};continue}const a=e[s[n]||n];if(a)try{let e=!1;if("BETVIP"===a.grupo){e=await f(t.tabId,c,!1),o[n]=e?{success:!0}:{success:!1,error:"Falha ao preencher Shadow DOM"};continue}if("BETFAST"===a.grupo){e=await g(t.tabId,c,!1),o[n]=e?{success:!0}:{success:!1,error:"Falha ao preencher BETFAST"};continue}if("sevenk"===n||"cassino"===n||"betdasorte"===n||"bullsbet"===n||"apostatudo"===n||"pix"===n||"betpontobet"===n||"sortenabet"===n||"brx"===n||"betgorillas"===n||"vera"===n||"betbuffalos"===n||"betfalcons"===n||"apostamax"===n||"rico"===n||"b2x"===n||"betaki"===n||"jogao"===n||"donald"===n||"betfusion"===n||"kingpanda"===n){e=await p(t.tabId,c),o[n]=e?{success:!0}:{success:!1,error:"Falha ao preencher iframe SEVENK"};continue}if("pinnacle"===n){e=await m(t.tabId,c),o[n]=e?{success:!0}:{success:!1,error:"Falha ao preencher iframe PINNACLE"};continue}if("betsson"===n){e=await m(t.tabId,c),o[n]=e?{success:!0}:{success:!1,error:"Falha ao preencher iframe BETSSON"};continue}if(!a.stakeSelector){o[n]={success:!1,error:"stakeSelector não encontrado"};continue}if("contenteditable"===a.stakeInputType){e=await h(t.tabId,a.stakeSelector,c,a),o[n]=e?{success:!0}:{success:!1,error:"Falha ao preencher contenteditable"};continue}const s=await chrome.scripting.executeScript({target:{tabId:t.tabId},func:(e,t)=>new Promise(n=>{try{const o=Array.isArray(e)?e:[e];for(const e of o){const o=document.querySelector(e);if(o)return"true"===o.dataset.filling?void n(!1):(o.dataset.filling="true",o.focus(),o.click(),o.value="",o.dispatchEvent(new Event("input",{bubbles:!0})),void setTimeout(()=>{let e=0;!function s(){if(e<t.length){const n=t[e];o.dispatchEvent(new KeyboardEvent("keydown",{key:n,code:"Digit"+n,bubbles:!0})),o.value+=n,o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new KeyboardEvent("keyup",{key:n,code:"Digit"+n,bubbles:!0})),e++,setTimeout(s,50)}else o.dispatchEvent(new Event("change",{bubbles:!0})),o.dispatchEvent(new Event("blur",{bubbles:!0})),o.dataset.filling="false",n(!0)}()},100))}n(!1)}catch(e){n(!1)}}),args:[a.stakeSelector,c.toString()]});s&&s[0]&&s[0].result?o[n]={success:!0}:o[n]={success:!1,error:"Seletor não encontrado"}}catch(e){o[n]={success:!1,error:e.message}}else o[n]={success:!1,error:"Config não encontrada"}}return{success:!0,results:o,filled:Object.entries(o).filter(([e,t])=>t.success).map(([e])=>e)}}(o.stakes,o.sessionId);case"clickBetButtons":return await async function(t){const n={};if(!t||0===t.length)return{success:!1,error:"Nenhuma casa especificada"};const o=await l(sessionId);if(!o.success)return{success:!1,error:"Erro ao detectar casas abertas"};for(const s of t){const t=o.bookmakers.find(e=>e.key===s);if(!t){n[s]={success:!1,error:"Casa não aberta"};continue}const r=e[s];if(r&&r.betButton)try{const e=await chrome.scripting.executeScript({target:{tabId:t.tabId},func:e=>{try{const t=Array.isArray(e)?e:[e];for(const e of t){const t=document.querySelector(e);if(t)return t.click(),!0}return!1}catch(e){return!1}},args:[r.betButton]});e&&e[0]&&e[0].result?n[s]={success:!0}:n[s]={success:!1,error:"Botão não encontrado"}}catch(e){n[s]={success:!1,error:e.message}}else n[s]={success:!1,error:"Botão não configurado"}}return{success:!0,results:n,clicked:Object.entries(n).filter(([e,t])=>t.success).map(([e])=>e)}}(o.bookmakers);case"clearBetslips":return await async function(n=null){return new Promise(o=>{chrome.tabs.query({},async s=>{let r=0;const c=[],a=n&&t.get(n)||[],i=a.length>0;for(const t of s)if(t.url&&(!i||a.includes(t.id)))for(const[n,o]of Object.entries(e))if(t.url.includes(o.urlPattern)){if(c.push(t.id),o.clearSelector)try{const e=await chrome.scripting.executeScript({target:{tabId:t.id},func:(e,t)=>{let n=0;if(["betvip","blaze","jonbet","ganhei","ux","afun"].includes(e)){const e=document.querySelector("#bt-inner-page");return e&&e.shadowRoot&&e.shadowRoot.querySelectorAll(t).forEach(e=>{e&&"none"!==window.getComputedStyle(e).display&&(e.click(),n++)}),n}document.querySelectorAll(t).forEach(e=>{e&&"none"!==window.getComputedStyle(e).display&&(e.click(),n++)});const o=document.querySelectorAll("iframe");for(let e of o)try{(e.contentDocument||e.contentWindow.document).querySelectorAll(t).forEach(e=>{e&&"none"!==window.getComputedStyle(e).display&&(e.click(),n++)})}catch(e){}return n},args:[n,o.clearSelector]});e&&e[0]&&e[0].result>0&&(r+=e[0].result)}catch(e){}break}setTimeout(()=>{c.forEach(e=>{chrome.tabs.remove(e,()=>{})}),chrome.tabs.query({url:["https://app.gestaobet.com/calculadora*","http://localhost:*/calculadora*"]},e=>{e&&e.length>0&&e.forEach(e=>{chrome.tabs.remove(e.id,()=>{})})}),setTimeout(()=>{o({success:c.length>0,totalCleared:r,totalClosed:c.length})},500)},2e3)})})}(o.sessionId);default:return{success:!1,error:"Ação desconhecida: "+n}}}(a.action,a.data).then(e=>{u(e)}).catch(e=>{u({success:!1,error:e.message})}),!0):"getAuthToken"===a.action?(chrome.storage.local.get(["authToken"],e=>{u({token:e.authToken||null})}),!0):"getConfig"===a.action&&(u({success:!0,config:{BOOKMAKERS:e||{}}}),!0))})();